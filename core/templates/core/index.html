{% extends "core/base.html" %}
{% load static %}

{% block header %}
<nav class="navbar fixed-top" style="background-color: #F7F4ED; border-bottom: 1px solid #ddd;">
  <div class="container position-relative">
    <div class="d-flex justify-content-center align-items-center w-100">
      <a class="btn btn-outline-secondary btn-sm text-decoration-none me-2" href="{% url 'core:pre' pre=current_date %}">
        <i class="bi bi-chevron-left fs-4" style="color: #2C2C2C;"></i>
      </a>
      <span class="fw-bold fs-5 mx-2" style="color: #2C2C2C;">{{ current_date|date:'n/j' }}</span>
      <a class="btn btn-outline-secondary btn-sm text-decoration-none ms-2" href="{% url 'core:post' post=current_date %}">
        <i class="bi bi-chevron-right fs-4" style="color: #2C2C2C;"></i>
      </a>
    </div>
    <div class="position-absolute top-0 end-0 d-flex">
      <a class="btn btn-sm text-decoration-none me-2" href="{% url 'core:index' %}">
        <i class="bi bi-arrow-clockwise fs-4" style="color: #2C2C2C;"></i>
      </a>
      <button class="btn text-decoration-none" data-bs-toggle="modal" data-bs-target="#calendarModal">
        <i class="bi bi-calendar3 fs-4" style="color: #2C2C2C;"></i>
      </button>
    </div>
  </div>
</nav>

<div class="modal fade" id="calendarModal" tabindex="-1" aria-labelledby="calendarModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content" style="border: 1px solid #ddd;">
      <div class="modal-header" style="background-color: #F7F4ED;">
        <h1 class="modal-title fs-5" id="calendarModalLabel" style="color: #2C2C2C;">Select Date</h1>
        <button type="button" class="btn-close"></button>
      </div>
      <div class="modal-body">
        <p style="color: #4A4A4A;">ここでカレンダーを表示し、日付を選択できるようにする想定</p>
        <form>
          <div class="mb-3">
            <label for="dateInput" class="form-label" style="color: #4A4A4A;">日付選択(ダミー)</label>
            <input type="date" class="form-control">
          </div>
          <button type="button" class="btn btn-primary" onclick="alert('日付指定で遷移は未実装'); return false;">移動</button>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block content %}
<div class="container my-5">
  <div class="row">
    <!-- PriorityTask カード -->
    <div class="col-12 my-3">
      <div class="card shadow-sm" style="border: 1px solid #ddd; border-left: 3px solid #2C2C2C; border-radius: 5px;">
        <div class="card-header" style="background-color: #F7F4ED; border-bottom: 1px solid #ddd; font-family: 'Bodoni Moda', serif; font-size: 1.25rem; color: #2C2C2C;">
          Priority Task
        </div>
        {% if task %}
        <ul class="list-group list-group-flush">
          {% if task.task1 %}
          <li class="list-group-item bg-transparent" style="font-family: 'Roboto', sans-serif; color: #4A4A4A;">{{ task.task1 }}</li>
          {% endif %}
          {% if task.task2 %}
          <li class="list-group-item bg-transparent" style="font-family: 'Roboto', sans-serif; color: #4A4A4A;">{{ task.task2 }}</li>
          {% endif %}
          {% if task.task3 %}
          <li class="list-group-item bg-transparent" style="font-family: 'Roboto', sans-serif; color: #4A4A4A;">{{ task.task3 }}</li>
          {% endif %}
        </ul>
        <div class="card-footer bg-transparent" style="border-top: 1px solid #ddd; text-align: right;">
          <a href="{% url 'PriorityTask:edit' pk=task.id %}" class="btn btn-outline-secondary btn-sm me-2" style="color: #5d4037; border-color: #5d4037;">編集</a>
          <form action="{% url 'PriorityTask:delete' pk=task.id %}" method="POST" class="d-inline" onsubmit="return confirm('本当に削除しますか？')">
            {% csrf_token %}
            <button type="submit" class="btn btn-outline-secondary btn-sm" style="color: #5d4037; border-color: #5d4037;">削除</button>
          </form>
        </div>
        {% elif current_date > today %}
        <div class="card-body">
          <p class="h5 mb-0" style="color: #8C8C8C;">まだ先のお話、、、</p>
        </div>
        {% else %}
        <div class="card-body">
          <a href="{% url 'PriorityTask:add' %}" class="btn btn-outline-primary w-100" style="border-color: #5d4037; color: #5d4037;">タスクを追加</a>
        </div>
        {% endif %}
      </div>
    </div>

    <!-- Habit カード -->
    <div class="col-12 my-3">
      <div class="card shadow-sm" style="border: 1px solid #ddd; border-left: 3px solid #2C2C2C; border-radius: 5px;">
        <div class="card-header" style="background-color: #F7F4ED; border-bottom: 1px solid #ddd; font-family: 'Bodoni Moda', serif; font-size: 1.25rem; color: #2C2C2C;">
          Habit
        </div>
        <div class="card-body">
          {% if habit_data %}
            <ul class="list-group list-group-flush">
              {% for habitdata in habit_data %}
              <li class="list-group-item d-flex justify-content-between align-items-center  bg-transparent" style="border: none;">
                <div>
                  <h5 class="mb-1" style="font-family: 'Roboto', sans-serif; color: #4A4A4A;">{{ habitdata.habit.name }}</h5>
                  <small style="color: #8C8C8C;">今週の達成率：{{ habitdata.weekly_rate }}%</small><br>
                  <small style="color: #8C8C8C;">習慣化率：{{ habitdata.success_weeks }}/13 ({{ habitdata.success_percentage }}%)</small>
                </div>
                <div class="btn-group" role="group">
                  <button type="button" class="btn btn-outline-success btn-sm" title="今日達成 (未実装)" style="color: #5d4037; border-color: #5d4037;">
                    <i class="bi bi-check-circle"></i>
                  </button>
                  <button type="button" class="btn btn-outline-primary btn-sm" title="編集 (未実装)" style="color: #5d4037; border-color: #5d4037;">
                    <i class="bi bi-pencil-square"></i>
                  </button>
                  <button type="button" class="btn btn-outline-danger btn-sm" title="削除 (未実装)" style="color: #5d4037; border-color: #5d4037;">
                    <i class="bi bi-trash3"></i>
                  </button>
                </div>
              </li>
              {% endfor %}
            </ul>
          {% else %}
            <p class="h5" style="color: #8C8C8C;">習慣が登録されていません。</p>
          {% endif %}
          <div class="mt-3 text-end">
            <button type="button" class="btn btn-outline-secondary btn-sm" title="習慣追加 (未実装)" style="color: #5d4037; border-color: #5d4037;">
              <i class="bi bi-plus-circle"></i> 習慣追加
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Tweet カード -->
    <div class="col-12 my-3">
      <div class="card shadow-sm" style="border: 1px solid #ddd; border-left: 3px solid #2C2C2C; border-radius: 5px; background-color: #fff;">
        <div class="card-header" style="background-color: #F7F4ED; border-bottom: 1px solid #ddd; font-family: 'Bodoni Moda', serif; font-size: 1.25rem; color: #2C2C2C;">
          Tweet
        </div>
        <div class="card-body">
          {% if tweets %}
            {% for tweet in tweets %}
            <div class="mb-3 position-relative">
              <div class="p-3" style="background-color: #F7F4ED; border: 1px solid #ddd; border-radius: 15px; font-family: 'Roboto', sans-serif; color: #4A4A4A;">
                {{ tweet.content }}
              </div>
              <form action="{% url 'Tweet:delete' pk=tweet.id %}" method="POST" class="position-absolute" style="top: 50%; right: 5px; transform: translateY(-50%);">
                {% csrf_token %}
                <button type="submit" class="btn btn-sm btn-outline-danger" title="削除" style="color: #5d4037; border-color: #5d4037;">
                  <i class="bi bi-trash3"></i>
                </button>
              </form>
            </div>
            {% endfor %}
          {% else %}
            <div class="text-center" style="color: #8C8C8C;">つぶやこう！</div>
          {% endif %}
          <div class="text-end">
            <a href="{% url 'Tweet:add' %}" class="btn btn-outline-success btn-sm" style="color: #5d4037; border-color: #5d4037;">追加する</a>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>
{% endblock %}

{% block footer %}
<nav class="navbar fixed-bottom" style="background-color: #F7F4ED; border-top: 1px solid #ddd;">
  <div class="container d-flex justify-content-around">
    <a href="#" class="nav-button" style="color: #2C2C2C;" onclick="alert('Today画面は未実装'); return false;">
      <i class="bi bi-house-door fs-5"></i><br><small>Today</small>
    </a>
    <a href="#" class="nav-button" style="color: #2C2C2C;" onclick="alert('Trends画面は未実装'); return false;">
      <i class="bi bi-graph-up fs-5"></i><br><small>Trends</small>
    </a>
    <a href="#" class="nav-button" style="color: #2C2C2C;" onclick="alert('Community画面は未実装'); return false;">
      <i class="bi bi-people fs-5"></i><br><small>Community</small>
    </a>
    <a href="#" class="nav-button" style="color: #2C2C2C;" onclick="alert('Profile画面は未実装'); return false;">
      <i class="bi bi-person fs-5"></i><br><small>Profile</small>
    </a>
  </div>
</nav>
{% endblock %}