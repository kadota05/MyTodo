# Pythonイメージをベースにする
FROM python:3.9-slim

# 作業ディレクトリ
WORKDIR /code

# システム更新とライブラリインストール
RUN apt-get update && apt-get install -y build-essential libpq-dev curl

# ローカルのrequirements.txtをコンテナにコピー
COPY requirements.txt /app/

# ライブラリをインストール
RUN pip install --no-cache-dir -r requirements.txt

# データディレクトリを作成
RUN mkdir -p /code/data

# プロジェクトのファイルを全部コピー
COPY . /code/

# Collect staticを行う（必要に応じて）
RUN python manage.py collectstatic --noinput

# ポートは8000を使う（DjangoのデフォルトやGunicornなどに合わせる）
EXPOSE 8000

# Gunicornサーバを起動するコマンド(ワーカーの数やオプションは適宜調整)
CMD gunicorn mysite.wsgi:application --bind 0.0.0.0:8000
